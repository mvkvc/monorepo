var u=(p,l,r)=>new Promise((m,w)=>{var a=t=>{try{o(r.next(t))}catch(s){w(s)}},b=t=>{try{o(r.throw(t))}catch(s){w(s)}},o=t=>t.done?m(t.value):Promise.resolve(t.value).then(a,b);o((r=r.apply(p,l)).next())});var n=require("vscode"),F=require("path"),U=function(){let p="editor.fold",l="editor.unfoldAll",r=`^ *@spec(.|
)*?(?=
\\s*(def|defp))`,m="^ *@spec {.*?}.*?$",a,o={},t=!1,s={};function _(){a&&clearTimeout(a),a=setTimeout(T,200)}function y(e=!1){return u(this,null,function*(){T(),yield S(e)})}function E(){let e={opacity:n.workspace.getConfiguration("byespec").get("opacity").toString(),backgroundColor:n.workspace.getConfiguration("byespec").get("backgroundColor")};return n.workspace.getConfiguration("byespec").get("showIcon")&&(e.gutterIconPath=F.join(__dirname,"..","misc","icon.png"),e.gutterIconSize="contain"),e}function T(){if(t)return;let e=n.window.activeTextEditor;if(!e||!h(e))return;let i=v(e);D(i),o[i]=n.window.createTextEditorDecorationType(E()),n.workspace.getConfiguration("byespec").get("enabled")&&e.setDecorations(o[i],[...C(new RegExp(r,"gsm"),e),...C(new RegExp(m,"gsm"),e)])}function S(e=!1){return u(this,null,function*(){if(!n.workspace.getConfiguration("byespec").get("fold")||!n.workspace.getConfiguration("byespec").get("enabled")||t)return;let i=n.window.activeTextEditor;i&&h(i)&&(!e&&!R(i.document.fileName)||setTimeout(()=>u(this,null,function*(){let c=i.selection,d=C(new RegExp(r,"gsm"),i).map(f=>{let g=i.selection.active.with(f.start.line,0);return new n.Selection(g,g)});d.length>0&&(i.selections=d,yield n.commands.executeCommand(l),yield n.commands.executeCommand(p),setTimeout(()=>{i.selections=[c],i.revealRange(i.selections[0])},100))}),100))})}function C(e,i){let c,d=i.document.getText(),f=[];for(;c=e.exec(d);){let g=i.document.positionAt(c.index),L=i.document.positionAt(c.index+c[0].length);f.push(new n.Range(g,L))}return f}function h(e){return e.document.languageId=="elixir"}function x(){return u(this,null,function*(){A(),n.workspace.getConfiguration("byespec").get("enabled")&&(yield n.commands.executeCommand(l))})}function A(){for(let e in o)D(e)}function D(e){o[e]&&(o[e].dispose(),delete o[e])}function k(){t=!1,y(!0)}function O(){t=!0,x()}function N(e){e.languageId=="elixir"&&(s[e.fileName]?s[e.fileName]+=1:s[e.fileName]=1)}function I(e){e.languageId=="elixir"&&s[e.fileName]&&delete s[e.fileName]}function R(e){return s[e]==1}function v(e){return e.document.fileName}function M(e){e.subscriptions.push(n.commands.registerCommand("byespec.hideSig",k)),e.subscriptions.push(n.commands.registerCommand("byespec.showSig",O)),n.window.onDidChangeActiveTextEditor(()=>{y()},null,e.subscriptions),n.workspace.onDidChangeTextDocument(_,null,e.subscriptions),n.workspace.onDidOpenTextDocument(N,null,e.subscriptions),n.workspace.onDidCloseTextDocument(I,null,e.subscriptions),n.window.activeTextEditor&&y()}return{activate:M}}();module.exports=U;
